<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„Ø­Ù…Ù„Ø§Øª</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</div>
            <nav>
                <ul>
                    <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="orders.html">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a></li>
                    <li><a href="products.html">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a></li>
                    <li><a href="reports.html">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a></li>
                    <li class="active"><a href="marketing.html">Ø§Ù„ØªØ³ÙˆÙŠÙ‚</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="header">
                <h2>ğŸ“£ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ©</h2>
                <button class="add-campaign-btn" onclick="openCampaignModal()">+ Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </header>

            <section class="campaign-tabs-bar">
                <span class="campaign-tab active-tab" data-type="all">Ø§Ù„ÙƒÙ„ (0)</span>
                <span class="campaign-tab" data-type="active">Ø§Ù„Ù†Ø´Ø·Ø© (0)</span>
                <span class="campaign-tab" data-type="scheduled">Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© (0)</span>
                <span class="campaign-tab" data-type="finished">Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© (0)</span>
                <span class="campaign-tab" data-type="coupons">Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø®ØµÙ…</span>
            </section>

            <section class="campaigns-table-card">
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø©/Ø§Ù„ÙƒÙˆØ¯</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø£Ø¯Ø§Ø¡ (Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª)</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                            </tr>
                        </thead>
                        <tbody id="campaigns-table-body">
                            </tbody>
                    </table>
                </div>
            </section>
        </main>
        
        <div id="addCampaignModal" class="modal-overlay">
            <div class="modal-content large-modal">
                <span class="close-btn" onclick="closeCampaignModal()">&times;</span>
                <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù…Ù„Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                
                <form class="campaign-form">
                    <div class="card campaign-section">
                        <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</h4>
                        <div class="form-group">
                            <label for="campaignName">Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø© (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ):</label>
                            <input type="text" id="campaignName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="campaignType">Ù†ÙˆØ¹ Ø§Ù„Ø­Ù…Ù„Ø©:</label>
                            <select id="campaignType" required>
                                <option value="coupon">ÙƒÙˆØ¯ Ø®ØµÙ… (Coupon)</option>
                                <option value="flash_sale">Ø¹Ø±Ø¶ ØªØ®ÙÙŠØ¶ Ø³Ø±ÙŠØ¹ (Flash Sale)</option>
                                <option value="free_shipping">Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ</option>
                            </select>
                        </div>
                    </div>

                    <div class="card campaign-section">
                        <h4>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ ÙˆØ§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</h4>
                        <div class="form-row">
                            <div class="form-group half-width">
                                <label for="startDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡:</label>
                                <input type="date" id="startDate" required>
                            </div>
                            <div class="form-group half-width">
                                <label for="endDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                                <input type="date" id="endDate">
                            </div>
                        </div>
                    </div>

                    <div class="card campaign-section" id="discountDetails">
                        <h4>ØªÙØ§ØµÙŠÙ„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…</h4>
                        <div class="form-group">
                            <label for="couponCode">ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… (Ù…Ø«Ø§Ù„: EID2026):</label>
                            <input type="text" id="couponCode">
                        </div>

                        <div class="form-row">
                            <div class="form-group third-width">
                                <label for="discountValue">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…:</label>
                                <input type="number" id="discountValue" min="1">
                            </div>
                            <div class="form-group third-width">
                                <label for="discountType">Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠÙ…Ø©:</label>
                                <select id="discountType">
                                    <option value="percentage">% Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©</option>
                                    <option value="fixed_amount">Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª (Ø±Ø³)</option>
                                </select>
                            </div>
                            <div class="form-group third-width">
                                <label for="usageLimit">Ø­Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</label>
                                <input type="number" id="usageLimit" min="1" placeholder="ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="cancel-btn" onclick="closeCampaignModal()">Ø¥Ù„ØºØ§Ø¡</button>
                        <button type="submit" class="save-btn">Ø­ÙØ¸ ÙˆØ¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script> 

    <script>
        // âš ï¸ Ù…Ù‡Ù…: ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØ§ØªÙŠØ­Ùƒ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹ "osama-alqisee"
        const firebaseConfig = {
            apiKey: "AIzaSyBNQ7YzUxzveUorMgHraMii7C5uZ-K8b6s",
            authDomain: "osama-alqisee.firebaseapp.com",
            projectId: "osama-alqisee",
            storageBucket: "osama-alqisee.firebasestorage.app",
            messagingSenderId: "689498064354",
            appId: "1:689498064354:web:956a072dd4e9ee99f2e5bb",
            measurementId: "G-F8GL8K46W5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        firebase.analytics();
    </script>

    <script>
        const campaignsTableBody = document.getElementById('campaigns-table-body');
        const campaignTabs = document.querySelectorAll('.campaign-tab');
        
        // * ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Modal) *
        function openCampaignModal() {
            document.getElementById('addCampaignModal').style.display = 'flex';
        }

        function closeCampaignModal() {
            document.getElementById('addCampaignModal').style.display = 'none';
            document.querySelector('.campaign-form').reset();
        }
        
        // ------------------------------------------------------------------
        // * ÙˆØ¸Ø§Ø¦Ù Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
        // ------------------------------------------------------------------

        // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¨Ù†Ø§Ø¡ ØµÙ Ø§Ù„Ø­Ù…Ù„Ø©
        function buildCampaignRow(campaign, id) {
            const row = document.createElement('tr');
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            let statusText = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            let statusClass = 'default-badge';
            
            if (campaign.status === 'active') {
                statusText = 'Ù†Ø´Ø·';
                statusClass = 'completed-badge';
            } else if (campaign.status === 'scheduled') {
                statusText = 'Ù…Ø¬Ø¯ÙˆÙ„';
                statusClass = 'pending-badge';
            } else if (campaign.status === 'finished') {
                statusText = 'Ù…Ù†ØªÙ‡Ù';
                statusClass = 'default-badge';
            } else if (campaign.type === 'coupon') {
                 statusText = campaign.isActive ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·';
                 statusClass = campaign.isActive ? 'completed-badge' : 'default-badge';
            }
            
            // ØªØ­ÙˆÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
            const endDate = campaign.endDate 
                ? new Date(campaign.endDate).toLocaleDateString('ar-EG') 
                : 'Ø¨Ù„Ø§ ØªØ§Ø±ÙŠØ®';

            row.setAttribute('data-type', campaign.type === 'coupon' ? 'coupons' : campaign.status);
            
            row.innerHTML = `
                <td data-label="Ø§Ø³Ù… Ø§Ù„Ø­Ù…Ù„Ø©">${campaign.name || campaign.couponCode}</td>
                <td data-label="Ø§Ù„Ù†ÙˆØ¹">${campaign.type === 'coupon' ? 'ÙƒÙˆØ¯ Ø®ØµÙ…' : 'ØªØ®ÙÙŠØ¶ Ù…Ø¨Ø§Ø´Ø±'}</td>
                <td data-label="ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡">${endDate}</td>
                <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </td>
                <td data-label="Ø§Ù„Ø£Ø¯Ø§Ø¡">${campaign.performance ? campaign.performance.toFixed(2) + ' Ø±Ø³' : '--'}</td>
                <td data-label="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡">
                    <button class="action-btn edit-btn" data-campaign-id="${id}">ØªØ¹Ø¯ÙŠÙ„</button>
                    <button class="action-btn delete-btn" data-campaign-id="${id}">Ø­Ø°Ù</button>
                </td>
            `;
            return row;
        }


        // ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­Ù…Ù„Ø§Øª Ù…Ù† Firestore
        async function fetchAndRenderCampaigns() {
            campaignsTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª...</td></tr>';
            
            try {
                // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù…Ù„Ø§Øª Ù…Ø±ØªØ¨Ø© Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
                const snapshot = await db.collection("campaigns").orderBy("createdAt", "desc").get();
                
                campaignsTableBody.innerHTML = ''; 

                if (snapshot.empty) {
                    campaignsTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</td></tr>';
                    return;
                }

                snapshot.forEach(doc => {
                    const campaignData = doc.data();
                    const campaignId = doc.id;
                    
                    const newRow = buildCampaignRow(campaignData, campaignId);
                    campaignsTableBody.appendChild(newRow);
                });

                // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ­Ø¯ÙŠØ« Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Ø§Ù„ÙƒÙ„ØŒ Ø§Ù„Ù†Ø´Ø·Ø©ØŒ Ø¥Ù„Ø®) ÙŠØªÙ… Ù‡Ù†Ø§ Ø£ÙŠØ¶Ø§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                
            } catch (error) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø­Ù…Ù„Ø§Øª Ù…Ù† Firestore: ", error);
                campaignsTableBody.innerHTML = `<tr><td colspan="6" style="color: red; text-align: center;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª.</td></tr>`;
            }
        }
        
        // ------------------------------------------------------------------
        // * ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ Ø§Ù„Ø­Ù…Ù„Ø© (Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ù€ Firestore)
        // ------------------------------------------------------------------

        function saveCampaign(data) {
            console.log("Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù…Ù„Ø© Ø¥Ù„Ù‰ Firebase Firestore...");
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø¡ ÙƒÙ€ Timestamp Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
            data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
            if (data.startDate) {
                // Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ Timestamp Ø£Ùˆ Ø­ÙØ¸Ù‡Ø§ ÙƒØ³Ù„Ø³Ù„Ø© Ù†ØµÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
            }
            
            db.collection("campaigns").add(data)
            .then(() => {
                alert(`âœ… ØªÙ… Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø© "${data.name}" Ø¨Ù†Ø¬Ø§Ø­!`);
                closeCampaignModal();
                fetchAndRenderCampaigns(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            })
            .catch((error) => {
                console.error("âŒ ÙØ´Ù„ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©: ", error);
                alert("âŒ ÙØ´Ù„ Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ø­Ù…Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Console.");
            });
        }
        
        // ØªØ¹Ø¯ÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        function handleCampaignSubmission() {
            const form = document.querySelector('.campaign-form');
            const campaignData = {
                name: document.getElementById('campaignName').value,
                type: document.getElementById('campaignType').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value || null,
                couponCode: document.getElementById('couponCode').value || null,
                discountValue: parseFloat(document.getElementById('discountValue').value) || 0,
                discountType: document.getElementById('discountType').value || 'percentage',
                usageLimit: parseInt(document.getElementById('usageLimit').value) || null,
                status: 'scheduled', // Ø­Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
                performance: 0, // Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„ØµÙØ±
            };
            
            saveCampaign(campaignData);
        }

        // ------------------------------------------------------------------
        // * ÙˆØ¸ÙŠÙØ© ÙÙ„ØªØ±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©)
        // ------------------------------------------------------------------
        
        campaignTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                campaignTabs.forEach(t => t.classList.remove('active-tab'));
                this.classList.add('active-tab');

                const selectedType = this.getAttribute('data-type');
                // Ø§Ø³ØªÙ‡Ø¯Ø§Ù ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„Ù‡Ø§
                const campaignRows = document.querySelectorAll('#campaigns-table-body tr'); 
                
                campaignRows.forEach(row => {
                    const rowType = row.getAttribute('data-type');

                    if (selectedType === 'all' || rowType === selectedType) {
                        row.style.display = ''; 
                    } else {
                        row.style.display = 'none';
                    }
                });
            });
        });

        // ØªØ´ØºÙŠÙ„ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        fetchAndRenderCampaigns();
    </script>
</body>
</html>
